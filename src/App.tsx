import {
  Canvas,
  Vec2dModel,
  TLShapeId,
  TldrawEditor,
  useEditor,
} from "@tldraw/tldraw";
import "@tldraw/tldraw/editor.css";
import { useEffect } from "react";
import { track } from "signia-react";
import "./custom-ui.css";

export default function CustomUiExample() {
  return (
    <div className="tldraw__editor" style={{ height: "80vh" }}>
      <TldrawEditor autoFocus>
        <Canvas />
        <CustomUi />
      </TldrawEditor>
    </div>
  );
}

const CustomUi = track(() => {
  let isClicked = false;
  const shapeArr: Vec2dModel[] = [];
  document.addEventListener("pointerdown", () => {
    isClicked = true;
  });
  document.addEventListener("pointermove", (e: PointerEvent) => {
    if (isClicked) {
      const heightRatio = 479 / 969;
      const widthRatio = 1005 / 1309;
      shapeArr.push({ x: e.x * widthRatio, y: e.y * heightRatio, z: 0 });
      console.log(shapeArr);
    }
  });
  document.addEventListener("pointerup", () => {
    isClicked = false;
  });
  const editor = useEditor();
  editor.canMoveCamera = false;
  useEffect(() => {
    editor.createShapes([
      {
        id: `shape:${Date.now()}` as TLShapeId,
        type: "draw",
        x: 0,
        y: 0,
        props: {
          color: "black",
          size: "s",
          segments: [
            {
              type: "free",
              points: [
                {
                  x: 525.9167303284951,
                  y: 139.8937048503612,
                  z: 0,
                },
                {
                  x: 525.1489686783805,
                  y: 139.8937048503612,
                  z: 0,
                },
                {
                  x: 524.3812070282659,
                  y: 139.8937048503612,
                  z: 0,
                },
                {
                  x: 522.077922077922,
                  y: 140.38802889576883,
                  z: 0,
                },
                {
                  x: 519.0068754774637,
                  y: 140.88235294117646,
                  z: 0,
                },
                {
                  x: 512.864782276547,
                  y: 141.87100103199174,
                  z: 0,
                },
                {
                  x: 506.7226890756303,
                  y: 143.8482972136223,
                  z: 0,
                },
                {
                  x: 502.1161191749427,
                  y: 144.83694530443756,
                  z: 0,
                },
                {
                  x: 495.974025974026,
                  y: 145.82559339525284,
                  z: 0,
                },
                {
                  x: 487.5286478227655,
                  y: 147.8028895768834,
                  z: 0,
                },
                {
                  x: 479.8510313216196,
                  y: 149.78018575851394,
                  z: 0,
                },
                {
                  x: 469.87012987012986,
                  y: 153.2404540763674,
                  z: 0,
                },
                {
                  x: 459.8892284186402,
                  y: 156.70072239422086,
                  z: 0,
                },
                {
                  x: 456.0504201680672,
                  y: 158.67801857585138,
                  z: 0,
                },
                {
                  x: 455.28265851795265,
                  y: 158.67801857585138,
                  z: 0,
                },
                {
                  x: 444.5339954163484,
                  y: 170.04747162022704,
                  z: 0,
                },
                {
                  x: 445.3017570664629,
                  y: 172.0247678018576,
                  z: 0,
                },
                {
                  x: 448.3728036669213,
                  y: 174.49638802889578,
                  z: 0,
                },
                {
                  x: 450.67608861726507,
                  y: 176.47368421052633,
                  z: 0,
                },
                {
                  x: 455.28265851795265,
                  y: 178.94530443756452,
                  z: 0,
                },
                {
                  x: 459.1214667685256,
                  y: 180.4282765737874,
                  z: 0,
                },
                {
                  x: 470.63789152024447,
                  y: 185.37151702786377,
                  z: 0,
                },
                {
                  x: 479.083269671505,
                  y: 188.3374613003096,
                  z: 0,
                },
                {
                  x: 492.90297937356763,
                  y: 192.2920536635707,
                  z: 0,
                },
                {
                  x: 504.41940412528646,
                  y: 195.25799793601652,
                  z: 0,
                },
                {
                  x: 516.7035905271199,
                  y: 197.7296181630547,
                  z: 0,
                },
                {
                  x: 558.9304812834224,
                  y: 208.11042311661507,
                  z: 0,
                },
                {
                  x: 579.6600458365165,
                  y: 214.53663570691435,
                  z: 0,
                },
                {
                  x: 583.4988540870894,
                  y: 216.5139318885449,
                  z: 0,
                },
                {
                  x: 587.3376623376623,
                  y: 217.99690402476782,
                  z: 0,
                },
                {
                  x: 590.4087089381208,
                  y: 219.97420020639836,
                  z: 0,
                },
                {
                  x: 591.9442322383499,
                  y: 220.96284829721364,
                  z: 0,
                },
                {
                  x: 592.7119938884645,
                  y: 221.45717234262128,
                  z: 0,
                },
                {
                  x: 593.4797555385791,
                  y: 222.44582043343652,
                  z: 0,
                },
                {
                  x: 593.4797555385791,
                  y: 222.94014447884416,
                  z: 0,
                },
                {
                  x: 593.4797555385791,
                  y: 224.42311661506707,
                  z: 0,
                },
                {
                  x: 593.4797555385791,
                  y: 225.41176470588235,
                  z: 0,
                },
                {
                  x: 593.4797555385791,
                  y: 226.40041279669762,
                  z: 0,
                },
                {
                  x: 591.1764705882352,
                  y: 227.3890608875129,
                  z: 0,
                },
                {
                  x: 588.8731856378915,
                  y: 229.36635706914345,
                  z: 0,
                },
                {
                  x: 558.9304812834224,
                  y: 238.26418988648092,
                  z: 0,
                },
                {
                  x: 532.0588235294118,
                  y: 243.20743034055727,
                  z: 0,
                },
                {
                  x: 519.0068754774637,
                  y: 245.18472652218782,
                  z: 0,
                },
                {
                  x: 505.18716577540107,
                  y: 247.16202270381837,
                  z: 0,
                },
                {
                  x: 485.9931245225363,
                  y: 249.13931888544892,
                  z: 0,
                },
                {
                  x: 459.8892284186402,
                  y: 251.6109391124871,
                  z: 0,
                },
                {
                  x: 449.1405653170359,
                  y: 252.10526315789474,
                  z: 0,
                },
                {
                  x: 435.32085561497325,
                  y: 253.09391124871001,
                  z: 0,
                },
                {
                  x: 421.5011459129106,
                  y: 254.0825593395253,
                  z: 0,
                },
                {
                  x: 403.842627960275,
                  y: 255.5655314757482,
                  z: 0,
                },
                {
                  x: 379.2742551566081,
                  y: 260.01444788441694,
                  z: 0,
                },
                {
                  x: 376.2032085561497,
                  y: 261.4974200206398,
                  z: 0,
                },
                {
                  x: 373.89992360580595,
                  y: 262.98039215686276,
                  z: 0,
                },
                {
                  x: 372.3644003055768,
                  y: 263.96904024767804,
                  z: 0,
                },
                {
                  x: 371.5966386554622,
                  y: 265.4520123839009,
                  z: 0,
                },
                {
                  x: 371.5966386554622,
                  y: 266.4406604747162,
                  z: 0,
                },
                {
                  x: 371.5966386554622,
                  y: 267.92363261093914,
                  z: 0,
                },
                {
                  x: 371.5966386554622,
                  y: 269.406604747162,
                  z: 0,
                },
                {
                  x: 373.13216195569134,
                  y: 271.38390092879257,
                  z: 0,
                },
                {
                  x: 373.89992360580595,
                  y: 272.8668730650155,
                  z: 0,
                },
                {
                  x: 376.2032085561497,
                  y: 274.844169246646,
                  z: 0,
                },
                {
                  x: 378.5064935064935,
                  y: 276.82146542827655,
                  z: 0,
                },
                {
                  x: 383.1130634071811,
                  y: 280.28173374613004,
                  z: 0,
                },
                {
                  x: 387.7196333078686,
                  y: 284.23632610939114,
                  z: 0,
                },
                {
                  x: 398.4682964094729,
                  y: 289.6738906088751,
                  z: 0,
                },
                {
                  x: 407.681436210848,
                  y: 294.1228070175439,
                  z: 0,
                },
                {
                  x: 425.3399541634836,
                  y: 300.54901960784315,
                  z: 0,
                },
                {
                  x: 439.15966386554624,
                  y: 304.50361197110425,
                  z: 0,
                },
                {
                  x: 462.19251336898395,
                  y: 309.4468524251806,
                  z: 0,
                },
                {
                  x: 487.5286478227655,
                  y: 312.41279669762645,
                  z: 0,
                },
                {
                  x: 506.7226890756303,
                  y: 314.8844169246646,
                  z: 0,
                },
                {
                  x: 520.5423987776929,
                  y: 315.8730650154799,
                  z: 0,
                },
                {
                  x: 531.2910618792972,
                  y: 317.35603715170276,
                  z: 0,
                },
                {
                  x: 535.8976317799847,
                  y: 317.85036119711043,
                  z: 0,
                },
                {
                  x: 538.2009167303285,
                  y: 318.34468524251804,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 318.34468524251804,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 318.8390092879257,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 319.3333333333333,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 319.827657378741,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 320.3219814241486,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 321.31062951496386,
                  z: 0,
                },
                {
                  x: 538.9686783804431,
                  y: 322.29927760577914,
                  z: 0,
                },
                {
                  x: 539.7364400305577,
                  y: 323.7822497420021,
                  z: 0,
                },
                {
                  x: 541.2719633307869,
                  y: 324.77089783281735,
                  z: 0,
                },
                {
                  x: 543.5752482811306,
                  y: 325.26522187822496,
                  z: 0,
                },
                {
                  x: 545.8785332314744,
                  y: 326.25386996904024,
                  z: 0,
                },
                {
                  x: 548.9495798319327,
                  y: 326.7481940144479,
                  z: 0,
                },
                {
                  x: 552.0206264323912,
                  y: 327.7368421052632,
                  z: 0,
                },
                {
                  x: 556.6271963330787,
                  y: 328.72549019607845,
                  z: 0,
                },
                {
                  x: 562.7692895339954,
                  y: 330.20846233230134,
                  z: 0,
                },
                {
                  x: 571.2146676852559,
                  y: 331.6914344685243,
                  z: 0,
                },
                {
                  x: 577.3567608861727,
                  y: 333.17440660474716,
                  z: 0,
                },
                {
                  x: 588.8731856378915,
                  y: 335.1517027863777,
                  z: 0,
                },
                {
                  x: 597.318563789152,
                  y: 336.63467492260065,
                  z: 0,
                },
                {
                  x: 622.6546982429336,
                  y: 338.61197110423115,
                  z: 0,
                },
                {
                  x: 627.2612681436211,
                  y: 339.1062951496388,
                  z: 0,
                },
              ],
            },
          ],
        },
      },
    ]);
  }, []);

  useEffect(() => {
    const handleKeyUp = (e: KeyboardEvent) => {
      switch (e.key) {
        case "Delete":
        case "Backspace": {
          editor.deleteShapes();
        }
      }
    };

    window.addEventListener("keyup", handleKeyUp);
    return () => {
      window.removeEventListener("keyup", handleKeyUp);
    };
  });

  return (
    <div className="custom-layout">
      <div className="custom-toolbar">
        <button
          className="custom-button"
          data-isactive={editor.currentToolId === "select"}
          onClick={() => editor.setSelectedTool("select")}
        >
          Select
        </button>
        <button
          className="custom-button"
          data-isactive={editor.currentToolId === "draw"}
          onClick={() => editor.setSelectedTool("draw")}
        >
          Pencil
        </button>
        <button
          className="custom-button"
          data-isactive={editor.currentToolId === "eraser"}
          onClick={() => editor.setSelectedTool("eraser")}
        >
          Eraser
        </button>
      </div>
    </div>
  );
});
